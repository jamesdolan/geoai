
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python package for using Artificial Intelligence (AI) with geospatial data">
      
      
        <meta name="author" content="opengeos">
      
      
        <link rel="canonical" href="https://geoai.gishub.org/download/">
      
      
        <link rel="prev" href="../geoai/">
      
      
        <link rel="next" href="../extract/">
      
      
      <link rel="icon" href="../assets/logo.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>download module - geoai</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRegular:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Google Sans";--md-code-font:"Regular"}</style>
      
    
    
      <link rel="stylesheet" href="../css/timeago.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#download-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="geoai" class="md-header__button md-logo" aria-label="geoai" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            geoai
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              download module
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/opengeos/geoai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="geoai" class="md-nav__button md-logo" aria-label="geoai" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    geoai
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/opengeos/geoai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/opengeos/geoai/releases" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/opengeos/geoai/issues" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report Issues
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/download_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Download data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/download_sentinel2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Download sentinel2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/planetary_computer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planetary computer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/view_metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    View metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/image_chips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image chips
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/building_footprints_usa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building footprints usa
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/building_footprints_africa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building footprints africa
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/building_footprints_china/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building footprints china
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/building_regularization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building regularization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/geometric_properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geometric properties
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/car_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Car detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/ship_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ship detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/solar_panel_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solar panel detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/text_prompt_segmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text prompt segmentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/parking_spot_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parking spot detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/data_visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/train_object_detection_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train object detection model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/train_building_footprints_usa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train building footprints usa
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/train_solar_panel_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train solar panel detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/train_car_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train car detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/train_ship_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Train ship detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/wetland_mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wetland mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/dataviz/raster_viz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raster viz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/dataviz/vector_viz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vector viz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/dataviz/lidar_viz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lidar viz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geoai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geoai module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    download module
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    download module
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geoai.download" class="md-nav__link">
    <span class="md-ellipsis">
      geoai.download
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.convert_vector_format" class="md-nav__link">
    <span class="md-ellipsis">
      convert_vector_format()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_naip" class="md-nav__link">
    <span class="md-ellipsis">
      download_naip()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_overture_buildings" class="md-nav__link">
    <span class="md-ellipsis">
      download_overture_buildings()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_pc_stac_item" class="md-nav__link">
    <span class="md-ellipsis">
      download_pc_stac_item()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_with_progress" class="md-nav__link">
    <span class="md-ellipsis">
      download_with_progress()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.extract_building_stats" class="md-nav__link">
    <span class="md-ellipsis">
      extract_building_stats()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.json_serializable" class="md-nav__link">
    <span class="md-ellipsis">
      json_serializable()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.pc_collection_list" class="md-nav__link">
    <span class="md-ellipsis">
      pc_collection_list()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.pc_stac_download" class="md-nav__link">
    <span class="md-ellipsis">
      pc_stac_download()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.pc_stac_search" class="md-nav__link">
    <span class="md-ellipsis">
      pc_stac_search()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.preview_raster" class="md-nav__link">
    <span class="md-ellipsis">
      preview_raster()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    extract module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hf module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../segmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    train module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geoai.download" class="md-nav__link">
    <span class="md-ellipsis">
      geoai.download
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.convert_vector_format" class="md-nav__link">
    <span class="md-ellipsis">
      convert_vector_format()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_naip" class="md-nav__link">
    <span class="md-ellipsis">
      download_naip()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_overture_buildings" class="md-nav__link">
    <span class="md-ellipsis">
      download_overture_buildings()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_pc_stac_item" class="md-nav__link">
    <span class="md-ellipsis">
      download_pc_stac_item()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.download_with_progress" class="md-nav__link">
    <span class="md-ellipsis">
      download_with_progress()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.extract_building_stats" class="md-nav__link">
    <span class="md-ellipsis">
      extract_building_stats()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.json_serializable" class="md-nav__link">
    <span class="md-ellipsis">
      json_serializable()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.pc_collection_list" class="md-nav__link">
    <span class="md-ellipsis">
      pc_collection_list()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.pc_stac_download" class="md-nav__link">
    <span class="md-ellipsis">
      pc_stac_download()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.pc_stac_search" class="md-nav__link">
    <span class="md-ellipsis">
      pc_stac_search()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geoai.download.preview_raster" class="md-nav__link">
    <span class="md-ellipsis">
      preview_raster()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


  
  


<h1 id="download-module">download module<a class="headerlink" href="#download-module" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="geoai.download"></a>
    <div class="doc doc-contents first">

      <p>This module provides functions to download data, including NAIP imagery and building data from Overture Maps.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h2 id="geoai.download.convert_vector_format" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_vector_format</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;geojson&#39;</span><span class="p">,</span> <span class="n">filter_expression</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#geoai.download.convert_vector_format" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Convert the downloaded data to a different format or filter it.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>input_file</code></td>
        <td><code>str</code></td>
        <td><p>Path to the input file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_format</code></td>
        <td><code>str</code></td>
        <td><p>Format to convert to, one of "geojson", "parquet", "shapefile", "csv".</p></td>
        <td><code>&#39;geojson&#39;</code></td>
      </tr>
      <tr>
        <td><code>filter_expression</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Optional GeoDataFrame query expression to filter the data.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Path to the converted file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_vector_format</span><span class="p">(</span>
    <span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span>
    <span class="n">filter_expression</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the downloaded data to a different format or filter it.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_file: Path to the input file.</span>
<span class="sd">        output_format: Format to convert to, one of &quot;geojson&quot;, &quot;parquet&quot;, &quot;shapefile&quot;, &quot;csv&quot;.</span>
<span class="sd">        filter_expression: Optional GeoDataFrame query expression to filter the data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path to the converted file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Read the input file</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading </span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

        <span class="c1"># Apply filter if specified</span>
        <span class="k">if</span> <span class="n">filter_expression</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtering data using expression: </span><span class="si">{</span><span class="n">filter_expression</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">filter_expression</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After filtering: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span><span class="si">}</span><span class="s2"> features&quot;</span><span class="p">)</span>

        <span class="c1"># Define output file path</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;geojson&quot;</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">.geojson&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting to GeoJSON: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;parquet&quot;</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">.parquet&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting to Parquet: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;shapefile&quot;</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">.shp&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting to Shapefile: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting to CSV: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># For CSV, we need to convert geometry to WKT</span>
            <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;geometry_wkt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">wkt</span><span class="p">)</span>

            <span class="c1"># Save to CSV with geometry as WKT</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported output format: </span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output_file</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.download_naip" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_naip</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#geoai.download.download_naip" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download NAIP imagery from Planetary Computer based on a bounding box.</p>
<p>This function searches for NAIP (National Agriculture Imagery Program) imagery
from Microsoft's Planetary Computer that intersects with the specified bounding box.
It downloads the imagery and saves it as GeoTIFF files.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bbox</code></td>
        <td><code>Tuple[float, float, float, float]</code></td>
        <td><p>Bounding box in the format (min_lon, min_lat, max_lon, max_lat) in WGS84 coordinates.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_dir</code></td>
        <td><code>str</code></td>
        <td><p>Directory to save the downloaded imagery.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>year</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Specific year of NAIP imagery to download (e.g., 2020). If None, returns imagery from all available years.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_items</code></td>
        <td><code>int</code></td>
        <td><p>Maximum number of items to download.</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>If True, overwrite existing files with the same name.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>preview</code></td>
        <td><code>bool</code></td>
        <td><p>If True, display a preview of the downloaded imagery.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[str]</code></td>
      <td><p>List of downloaded file paths.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>Exception</code></td>
        <td><p>If there is an error downloading or saving the imagery.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_naip</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_items</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download NAIP imagery from Planetary Computer based on a bounding box.</span>

<span class="sd">    This function searches for NAIP (National Agriculture Imagery Program) imagery</span>
<span class="sd">    from Microsoft&#39;s Planetary Computer that intersects with the specified bounding box.</span>
<span class="sd">    It downloads the imagery and saves it as GeoTIFF files.</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox: Bounding box in the format (min_lon, min_lat, max_lon, max_lat) in WGS84 coordinates.</span>
<span class="sd">        output_dir: Directory to save the downloaded imagery.</span>
<span class="sd">        year: Specific year of NAIP imagery to download (e.g., 2020). If None, returns imagery from all available years.</span>
<span class="sd">        max_items: Maximum number of items to download.</span>
<span class="sd">        overwrite: If True, overwrite existing files with the same name.</span>
<span class="sd">        preview: If True, display a preview of the downloaded imagery.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of downloaded file paths.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If there is an error downloading or saving the imagery.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create output directory if it doesn&#39;t exist</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create a geometry from the bounding box</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">bbox</span><span class="p">)</span>

    <span class="c1"># Connect to Planetary Computer STAC API</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;https://planetarycomputer.microsoft.com/api/stac/v1&quot;</span><span class="p">)</span>

    <span class="c1"># Build query for NAIP data</span>
    <span class="n">search_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;naip&quot;</span><span class="p">],</span>
        <span class="s2">&quot;intersects&quot;</span><span class="p">:</span> <span class="n">geometry</span><span class="p">,</span>
        <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">max_items</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Add year filter if specified</span>
    <span class="k">if</span> <span class="n">year</span><span class="p">:</span>
        <span class="n">search_params</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;naip:year&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;eq&quot;</span><span class="p">:</span> <span class="n">year</span><span class="p">}}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">search_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># Search for NAIP imagery</span>
    <span class="n">search_results</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">**</span><span class="n">search_params</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">search_results</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_items</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No NAIP imagery found for the specified region and parameters.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> NAIP items.&quot;</span><span class="p">)</span>

    <span class="c1"># Download and save each item</span>
    <span class="n">downloaded_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
        <span class="c1"># Sign the assets (required for Planetary Computer)</span>
        <span class="n">signed_item</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Get the RGB asset URL</span>
        <span class="n">rgb_asset</span> <span class="o">=</span> <span class="n">signed_item</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rgb_asset</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No RGB asset found for item </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Use the original filename from the asset</span>
        <span class="n">original_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
            <span class="n">rgb_asset</span><span class="o">.</span><span class="n">href</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># Remove query parameters</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">original_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping existing file: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">downloaded_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading item </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">original_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Open and save the data with progress bar</span>
            <span class="c1"># For direct file download with progress bar</span>
            <span class="k">if</span> <span class="n">rgb_asset</span><span class="o">.</span><span class="n">href</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
                <span class="n">download_with_progress</span><span class="p">(</span><span class="n">rgb_asset</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
                <span class="c1">#</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Fallback to direct rioxarray opening (less common case)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">rgb_asset</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>
                <span class="n">data</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>

            <span class="n">downloaded_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Optional: Display a preview (uncomment if needed)</span>
            <span class="k">if</span> <span class="n">preview</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
                <span class="n">preview_raster</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error downloading item </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">downloaded_files</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.download_overture_buildings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_overture_buildings</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;geojson&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;building&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#geoai.download.download_overture_buildings" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download building data from Overture Maps for a given bounding box using the overturemaps CLI tool.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bbox</code></td>
        <td><code>Tuple[float, float, float, float]</code></td>
        <td><p>Bounding box in the format (min_lon, min_lat, max_lon, max_lat) in WGS84 coordinates.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_file</code></td>
        <td><code>str</code></td>
        <td><p>Path to save the output file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_format</code></td>
        <td><code>str</code></td>
        <td><p>Format to save the output, one of "geojson", "geojsonseq", or "geoparquet".</p></td>
        <td><code>&#39;geojson&#39;</code></td>
      </tr>
      <tr>
        <td><code>data_type</code></td>
        <td><code>str</code></td>
        <td><p>The Overture Maps data type to download (building, place, etc.).</p></td>
        <td><code>&#39;building&#39;</code></td>
      </tr>
      <tr>
        <td><code>verbose</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to print verbose output.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Path to the output file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_overture_buildings</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;geojson&quot;</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;building&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download building data from Overture Maps for a given bounding box using the overturemaps CLI tool.</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox: Bounding box in the format (min_lon, min_lat, max_lon, max_lat) in WGS84 coordinates.</span>
<span class="sd">        output_file: Path to save the output file.</span>
<span class="sd">        output_format: Format to save the output, one of &quot;geojson&quot;, &quot;geojsonseq&quot;, or &quot;geoparquet&quot;.</span>
<span class="sd">        data_type: The Overture Maps data type to download (building, place, etc.).</span>
<span class="sd">        verbose: Whether to print verbose output.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path to the output file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create output directory if needed</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Format the bounding box string for the command</span>
    <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">north</span> <span class="o">=</span> <span class="n">bbox</span>
    <span class="n">bbox_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">west</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">south</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">east</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">north</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Build the command</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;overturemaps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;download&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--bbox&quot;</span><span class="p">,</span>
        <span class="n">bbox_str</span><span class="p">,</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="n">output_format</span><span class="p">,</span>
        <span class="s2">&quot;--type&quot;</span><span class="p">,</span>
        <span class="n">data_type</span><span class="p">,</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="n">output_file</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running command: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading </span><span class="si">%s</span><span class="s2"> data for area: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">bbox_str</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the command</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">cmd</span><span class="p">,</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Check if the file was created</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>  <span class="c1"># Size in MB</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully downloaded data to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">file_size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB)&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Optionally show some stats about the downloaded data</span>
            <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;geojson&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span><span class="si">}</span><span class="s2"> features&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="c1"># Show a sample of the attribute names</span>
                        <span class="n">attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                        <span class="n">attrs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available attributes: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attrs</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read the GeoJSON file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">output_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command completed but file </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> was not created&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command error output: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running overturemaps command: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command error output: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to download Overture Maps data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.download_pc_stac_item" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_pc_stac_item</span><span class="p">(</span><span class="n">item_url</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">merge_bands</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">merged_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cell_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#geoai.download.download_pc_stac_item" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Downloads a STAC item from Microsoft Planetary Computer with specified bands.</p>
<p>This function fetches a STAC item by URL, signs the assets using Planetary Computer
credentials, and downloads the specified bands with a progress bar. Can optionally
merge bands into a single multi-band GeoTIFF.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>item_url</code></td>
        <td><code>str</code></td>
        <td><p>The URL of the STAC item to download.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bands</code></td>
        <td><code>list</code></td>
        <td><p>List of specific bands to download (e.g., ['B01', 'B02']).
                   If None, all available bands will be downloaded.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>output_dir</code></td>
        <td><code>str</code></td>
        <td><p>Directory to save downloaded bands. If None,
                       bands are returned as xarray DataArrays.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>show_progress</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to display a progress bar. Default is True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>merge_bands</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to merge downloaded bands into a single
                         multi-band GeoTIFF file. Default is False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>merged_filename</code></td>
        <td><code>str</code></td>
        <td><p>Filename for the merged bands. If None and
                            merge_bands is True, uses "{item_id}_merged.tif".</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to overwrite existing files. Default is False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>cell_size</code></td>
        <td><code>float</code></td>
        <td><p>Resolution in meters for the merged output. If None,
                        uses the resolution of the first band.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Dictionary mapping band names to their corresponding xarray DataArrays
      or file paths if output_dir is provided. If merge_bands is True, also
      includes a 'merged' key with the path to the merged file.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the item cannot be retrieved or a requested band is not available.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_pc_stac_item</span><span class="p">(</span>
    <span class="n">item_url</span><span class="p">,</span>
    <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">merge_bands</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">merged_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads a STAC item from Microsoft Planetary Computer with specified bands.</span>

<span class="sd">    This function fetches a STAC item by URL, signs the assets using Planetary Computer</span>
<span class="sd">    credentials, and downloads the specified bands with a progress bar. Can optionally</span>
<span class="sd">    merge bands into a single multi-band GeoTIFF.</span>

<span class="sd">    Args:</span>
<span class="sd">        item_url (str): The URL of the STAC item to download.</span>
<span class="sd">        bands (list, optional): List of specific bands to download (e.g., [&#39;B01&#39;, &#39;B02&#39;]).</span>
<span class="sd">                               If None, all available bands will be downloaded.</span>
<span class="sd">        output_dir (str, optional): Directory to save downloaded bands. If None,</span>
<span class="sd">                                   bands are returned as xarray DataArrays.</span>
<span class="sd">        show_progress (bool, optional): Whether to display a progress bar. Default is True.</span>
<span class="sd">        merge_bands (bool, optional): Whether to merge downloaded bands into a single</span>
<span class="sd">                                     multi-band GeoTIFF file. Default is False.</span>
<span class="sd">        merged_filename (str, optional): Filename for the merged bands. If None and</span>
<span class="sd">                                        merge_bands is True, uses &quot;{item_id}_merged.tif&quot;.</span>
<span class="sd">        overwrite (bool, optional): Whether to overwrite existing files. Default is False.</span>
<span class="sd">        cell_size (float, optional): Resolution in meters for the merged output. If None,</span>
<span class="sd">                                    uses the resolution of the first band.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary mapping band names to their corresponding xarray DataArrays</span>
<span class="sd">              or file paths if output_dir is provided. If merge_bands is True, also</span>
<span class="sd">              includes a &#39;merged&#39; key with the path to the merged file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the item cannot be retrieved or a requested band is not available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">Resampling</span>

    <span class="c1"># Get the item ID from the URL</span>
    <span class="n">item_id</span> <span class="o">=</span> <span class="n">item_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">item_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/collections/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Connect to the Planetary Computer STAC API</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
        <span class="s2">&quot;https://planetarycomputer.microsoft.com/api/stac/v1&quot;</span><span class="p">,</span>
        <span class="n">modifier</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">sign_inplace</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Search for the specific item</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">collections</span><span class="o">=</span><span class="p">[</span><span class="n">collection</span><span class="p">],</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">item_id</span><span class="p">])</span>

    <span class="c1"># Get the first item from the search results</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">get_items</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Item with ID </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Determine which bands to download</span>
    <span class="n">available_assets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If no bands specified, download all band assets</span>
        <span class="n">bands_to_download</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asset</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">available_assets</span> <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Verify all requested bands exist</span>
        <span class="n">missing_bands</span> <span class="o">=</span> <span class="p">[</span><span class="n">band</span> <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span> <span class="k">if</span> <span class="n">band</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_assets</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_bands</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The following bands are not available: </span><span class="si">{</span><span class="n">missing_bands</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Available assets are: </span><span class="si">{</span><span class="n">available_assets</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">bands_to_download</span> <span class="o">=</span> <span class="n">bands</span>

    <span class="c1"># Create output directory if specified and doesn&#39;t exist</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">band_data_arrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">resampled_arrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">band_names</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Track band names in order</span>

    <span class="c1"># Set up progress bar</span>
    <span class="n">progress_iter</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">tqdm</span><span class="p">(</span><span class="n">bands_to_download</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Downloading bands&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_progress</span>
        <span class="k">else</span> <span class="n">bands_to_download</span>
    <span class="p">)</span>

    <span class="c1"># Download each requested band</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">progress_iter</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">band</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">assets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_progress</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">progress_iter</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">progress_iter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: Band </span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2"> not found in assets, skipping.&quot;</span>
                <span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">band_url</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">assets</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">.</span><span class="n">href</span>

        <span class="k">if</span> <span class="n">output_dir</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>

            <span class="c1"># Check if file exists and skip if overwrite is False</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_progress</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">progress_iter</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">progress_iter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> already exists, skipping (use overwrite=True to force download).&quot;</span>
                    <span class="p">)</span>
                <span class="c1"># Still need to open the file to get the data for merging</span>
                <span class="k">if</span> <span class="n">merge_bands</span><span class="p">:</span>
                    <span class="n">band_data</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">band_data_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">band</span><span class="p">,</span> <span class="n">band_data</span><span class="p">))</span>
                    <span class="n">band_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_path</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">show_progress</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">progress_iter</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">progress_iter</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">band_data</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">band_url</span><span class="p">)</span>

        <span class="c1"># Store the data array for potential merging later</span>
        <span class="k">if</span> <span class="n">merge_bands</span><span class="p">:</span>
            <span class="n">band_data_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">band</span><span class="p">,</span> <span class="n">band_data</span><span class="p">))</span>
            <span class="n">band_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output_dir</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
            <span class="n">band_data</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">band_data</span>

    <span class="c1"># Merge bands if requested</span>
    <span class="k">if</span> <span class="n">merge_bands</span> <span class="ow">and</span> <span class="n">output_dir</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">merged_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">merged_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_merged.tif&quot;</span>

        <span class="n">merged_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">merged_filename</span><span class="p">)</span>

        <span class="c1"># Check if merged file exists and skip if overwrite is False</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">merged_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Merged file </span><span class="si">{</span><span class="n">merged_path</span><span class="si">}</span><span class="s2"> already exists, skipping (use overwrite=True to force creation).&quot;</span>
                <span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;merged&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resampling and merging bands...&quot;</span><span class="p">)</span>

            <span class="c1"># Determine target cell size if not provided</span>
            <span class="k">if</span> <span class="n">cell_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">band_data_arrays</span><span class="p">:</span>
                <span class="c1"># Use the resolution of the first band (usually 10m for B02, B03, B04, B08)</span>
                <span class="c1"># Get the affine transform (containing resolution info)</span>
                <span class="n">first_band_data</span> <span class="o">=</span> <span class="n">band_data_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Extract resolution from transform</span>
                <span class="n">cell_size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">first_band_data</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">transform</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using detected resolution: </span><span class="si">{</span><span class="n">cell_size</span><span class="si">}</span><span class="s2">m&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cell_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Default to 10m if no bands are available</span>
                <span class="n">cell_size</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using default resolution: </span><span class="si">{</span><span class="n">cell_size</span><span class="si">}</span><span class="s2">m&quot;</span><span class="p">)</span>

            <span class="c1"># Process bands in memory-efficient way</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">band_name</span><span class="p">,</span> <span class="n">data_array</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">band_data_arrays</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing band: </span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Get current resolution</span>
                <span class="n">current_res</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data_array</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">transform</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># Resample if needed</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">current_res</span> <span class="o">-</span> <span class="n">cell_size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span>
                <span class="p">):</span>  <span class="c1"># Small tolerance for floating point comparison</span>
                    <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Resampling </span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">current_res</span><span class="si">}</span><span class="s2">m to </span><span class="si">{</span><span class="n">cell_size</span><span class="si">}</span><span class="s2">m&quot;</span>
                        <span class="p">)</span>

                    <span class="c1"># Use bilinear for downsampling (higher to lower resolution)</span>
                    <span class="c1"># Use nearest for upsampling (lower to higher resolution)</span>
                    <span class="n">resampling_method</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span>
                        <span class="k">if</span> <span class="n">current_res</span> <span class="o">&lt;</span> <span class="n">cell_size</span>
                        <span class="k">else</span> <span class="n">Resampling</span><span class="o">.</span><span class="n">nearest</span>
                    <span class="p">)</span>

                    <span class="n">resampled</span> <span class="o">=</span> <span class="n">data_array</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span>
                        <span class="n">data_array</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                        <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="n">cell_size</span><span class="p">,</span> <span class="n">cell_size</span><span class="p">),</span>
                        <span class="n">resampling</span><span class="o">=</span><span class="n">resampling_method</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">resampled_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resampled</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">resampled_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stacking bands...&quot;</span><span class="p">)</span>

            <span class="c1"># Concatenate all resampled arrays along the band dimension</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">merged_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">resampled_arrays</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;band&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing merged data to </span><span class="si">{</span><span class="n">merged_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

                <span class="c1"># Add description metadata</span>
                <span class="n">merged_data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Multi-band image containing </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">band_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Create a dictionary mapping band indices to band names</span>
                <span class="n">band_descriptions</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">band_names</span><span class="p">):</span>
                    <span class="n">band_descriptions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

                <span class="c1"># Write the merged data to file with band descriptions</span>
                <span class="n">merged_data</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span>
                    <span class="n">merged_path</span><span class="p">,</span>
                    <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;BAND_NAMES&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">band_names</span><span class="p">)},</span>
                    <span class="n">descriptions</span><span class="o">=</span><span class="n">band_names</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;merged&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_path</span>

                <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merged bands saved to: </span><span class="si">{</span><span class="n">merged_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Band order in merged file: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">band_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during merging: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error details: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">raise</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.download_with_progress" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_with_progress</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span></code>


<a href="#geoai.download.download_with_progress" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download a file with a progress bar.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>URL of the file to download.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_path</code></td>
        <td><code>str</code></td>
        <td><p>Path where the file will be saved.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_with_progress</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a file with a progress bar.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: URL of the file to download.</span>
<span class="sd">        output_path: Path where the file will be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># 1 Kibibyte</span>

    <span class="k">with</span> <span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">,</span>
        <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">desc</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span>
            <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;iB&quot;</span><span class="p">,</span>
            <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">unit_divisor</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">bar</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.extract_building_stats" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_building_stats</span><span class="p">(</span><span class="n">geojson_file</span><span class="p">)</span></code>


<a href="#geoai.download.extract_building_stats" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Extract statistics from the building data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geojson_file</code></td>
        <td><code>str</code></td>
        <td><p>Path to the GeoJSON file.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>Dictionary with statistics.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_building_stats</span><span class="p">(</span><span class="n">geojson_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract statistics from the building data.</span>

<span class="sd">    Args:</span>
<span class="sd">        geojson_file: Path to the GeoJSON file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with statistics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Read the GeoJSON file</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geojson_file</span><span class="p">)</span>

        <span class="c1"># Calculate statistics</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Convert numpy values to Python native types</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bbox</span><span class="p">]</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;total_buildings&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)),</span>
            <span class="s2">&quot;has_height&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="k">if</span> <span class="s2">&quot;height&quot;</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">),</span>
            <span class="s2">&quot;has_name&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;names.common.value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="k">if</span> <span class="s2">&quot;names.common.value&quot;</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">else</span> <span class="mi">0</span>
            <span class="p">),</span>
            <span class="s2">&quot;bbox&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting statistics: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.json_serializable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">json_serializable</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>


<a href="#geoai.download.json_serializable" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Convert NumPy types to native Python types for JSON serialization.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>obj</code></td>
        <td><code>Any</code></td>
        <td><p>Any object to convert.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>JSON serializable version of the object.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">json_serializable</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert NumPy types to native Python types for JSON serialization.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj: Any object to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        JSON serializable version of the object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.pc_collection_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pc_collection_list</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;https://planetarycomputer.microsoft.com/api/stac/v1&#39;</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span></code>


<a href="#geoai.download.pc_collection_list" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Retrieves and displays the list of available collections from Planetary Computer.</p>
<p>This function connects to the Planetary Computer STAC API and retrieves the
list of all available collections, with options to filter and sort the results.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>endpoint</code></td>
        <td><code>str</code></td>
        <td><p>STAC API endpoint URL.
Defaults to "https://planetarycomputer.microsoft.com/api/stac/v1".</p></td>
        <td><code>&#39;https://planetarycomputer.microsoft.com/api/stac/v1&#39;</code></td>
      </tr>
      <tr>
        <td><code>detailed</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to return detailed information for each
collection. If False, returns only basic info. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>filter_by</code></td>
        <td><code>dict</code></td>
        <td><p>Dictionary of field:value pairs to filter
collections. For example, {"license": "CC-BY-4.0"}. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sort_by</code></td>
        <td><code>str</code></td>
        <td><p>Field to sort the collections by.
Defaults to "id".</p></td>
        <td><code>&#39;id&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>pandas.DataFrame</code></td>
      <td><p>DataFrame containing collection information.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ConnectionError</code></td>
        <td><p>If there's an issue connecting to the API.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pc_collection_list</span><span class="p">(</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;https://planetarycomputer.microsoft.com/api/stac/v1&quot;</span><span class="p">,</span>
    <span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">filter_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves and displays the list of available collections from Planetary Computer.</span>

<span class="sd">    This function connects to the Planetary Computer STAC API and retrieves the</span>
<span class="sd">    list of all available collections, with options to filter and sort the results.</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (str, optional): STAC API endpoint URL.</span>
<span class="sd">            Defaults to &quot;https://planetarycomputer.microsoft.com/api/stac/v1&quot;.</span>
<span class="sd">        detailed (bool, optional): Whether to return detailed information for each</span>
<span class="sd">            collection. If False, returns only basic info. Defaults to False.</span>
<span class="sd">        filter_by (dict, optional): Dictionary of field:value pairs to filter</span>
<span class="sd">            collections. For example, {&quot;license&quot;: &quot;CC-BY-4.0&quot;}. Defaults to None.</span>
<span class="sd">        sort_by (str, optional): Field to sort the collections by.</span>
<span class="sd">            Defaults to &quot;id&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: DataFrame containing collection information.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If there&#39;s an issue connecting to the API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize the STAC client</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to STAC API at </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get all collections</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">get_collections</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error retrieving collections: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Basic info to extract from all collections</span>
    <span class="n">collection_info</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Extract information based on detail level</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
        <span class="c1"># Basic information always included</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="s2">&quot;No title&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">collection</span><span class="o">.</span><span class="n">description</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
                <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">description</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">description</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span>
                <span class="k">else</span> <span class="n">collection</span><span class="o">.</span><span class="n">description</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Add detailed information if requested</span>
        <span class="k">if</span> <span class="n">detailed</span><span class="p">:</span>
            <span class="c1"># Get temporal extent if available</span>
            <span class="n">temporal_extent</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
            <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">extent</span> <span class="ow">and</span> <span class="n">collection</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">temporal</span><span class="p">:</span>
                <span class="n">interval</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">collection</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">intervals</span>
                    <span class="k">else</span> <span class="kc">None</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">interval</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;Unknown Start&quot;</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;Present&quot;</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">temporal_extent</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Add additional details</span>
            <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;license&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="o">.</span><span class="n">license</span> <span class="ow">or</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;keywords&quot;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">keywords</span>
                        <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;temporal_extent&quot;</span><span class="p">:</span> <span class="n">temporal_extent</span><span class="p">,</span>
                    <span class="s2">&quot;asset_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span> <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">assets</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;providers&quot;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">providers</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">providers</span>
                        <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
                    <span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="c1"># Add spatial extent if available</span>
            <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">extent</span> <span class="ow">and</span> <span class="n">collection</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">spatial</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">collection</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">bboxes</span>
                    <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
                <span class="p">)</span>

        <span class="n">collection_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="c1"># Convert to DataFrame for easier filtering and sorting</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">collection_info</span><span class="p">)</span>

    <span class="c1"># Apply filtering if specified</span>
    <span class="k">if</span> <span class="n">filter_by</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">filter_by</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

    <span class="c1"># Apply sorting</span>
    <span class="k">if</span> <span class="n">sort_by</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> collections from Planetary Computer&quot;</span><span class="p">)</span>

    <span class="c1"># # Print a nicely formatted table</span>
    <span class="c1"># if not df.empty:</span>
    <span class="c1">#     print(&quot;\nAvailable collections:&quot;)</span>
    <span class="c1">#     print(tabulate(df, headers=&quot;keys&quot;, tablefmt=&quot;grid&quot;, showindex=False))</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.pc_stac_download" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pc_stac_download</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">asset_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">skip_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sign_urls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#geoai.download.pc_stac_download" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download assets from STAC items retrieved from the Planetary Computer.</p>
<p>This function downloads specified assets from a list of STAC items to the
specified output directory. It supports parallel downloads and can skip
already downloaded files.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>items</code></td>
        <td><code>list or pystac.Item</code></td>
        <td><p>STAC Item object or list of STAC Item objects.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output_dir</code></td>
        <td><code>str</code></td>
        <td><p>Directory where assets will be saved.
Defaults to current directory.</p></td>
        <td><code>&#39;.&#39;</code></td>
      </tr>
      <tr>
        <td><code>asset_keys</code></td>
        <td><code>list</code></td>
        <td><p>List of asset keys to download. If None,
downloads all available assets. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_workers</code></td>
        <td><code>int</code></td>
        <td><p>Maximum number of concurrent download threads.
Defaults to 4.</p></td>
        <td><code>4</code></td>
      </tr>
      <tr>
        <td><code>skip_existing</code></td>
        <td><code>bool</code></td>
        <td><p>Skip download if the file already exists.
Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>sign_urls</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to sign URLs for authenticated access.
Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Dictionary mapping STAC item IDs to dictionaries of their downloaded
    assets {asset_key: file_path}.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>TypeError</code></td>
        <td><p>If items is not a STAC Item or list of STAC Items.</p></td>
      </tr>
      <tr>
        <td><code>IOError</code></td>
        <td><p>If there's an error writing the downloaded assets to disk.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pc_stac_download</span><span class="p">(</span>
    <span class="n">items</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">asset_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">skip_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sign_urls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download assets from STAC items retrieved from the Planetary Computer.</span>

<span class="sd">    This function downloads specified assets from a list of STAC items to the</span>
<span class="sd">    specified output directory. It supports parallel downloads and can skip</span>
<span class="sd">    already downloaded files.</span>

<span class="sd">    Args:</span>
<span class="sd">        items (list or pystac.Item): STAC Item object or list of STAC Item objects.</span>
<span class="sd">        output_dir (str, optional): Directory where assets will be saved.</span>
<span class="sd">            Defaults to current directory.</span>
<span class="sd">        asset_keys (list, optional): List of asset keys to download. If None,</span>
<span class="sd">            downloads all available assets. Defaults to None.</span>
<span class="sd">        max_workers (int, optional): Maximum number of concurrent download threads.</span>
<span class="sd">            Defaults to 4.</span>
<span class="sd">        skip_existing (bool, optional): Skip download if the file already exists.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        sign_urls (bool, optional): Whether to sign URLs for authenticated access.</span>
<span class="sd">            Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary mapping STAC item IDs to dictionaries of their downloaded</span>
<span class="sd">            assets {asset_key: file_path}.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If items is not a STAC Item or list of STAC Items.</span>
<span class="sd">        IOError: If there&#39;s an error writing the downloaded assets to disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pystac</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>

    <span class="c1"># Handle single item case</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">pystac</span><span class="o">.</span><span class="n">Item</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;items must be a STAC Item or list of STAC Items&quot;</span><span class="p">)</span>

    <span class="c1"># Create output directory if it doesn&#39;t exist</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Function to sign URLs if needed</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_signed_url</span><span class="p">(</span><span class="n">href</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sign_urls</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">href</span>

        <span class="c1"># Planetary Computer typically requires signing URLs for accessing data</span>
        <span class="c1"># Check if the URL is from Microsoft Planetary Computer</span>
        <span class="k">if</span> <span class="s2">&quot;planetarycomputer&quot;</span> <span class="ow">in</span> <span class="n">href</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sign_url</span> <span class="o">=</span> <span class="s2">&quot;https://planetarycomputer.microsoft.com/api/sas/v1/sign&quot;</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sign_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;href&quot;</span><span class="p">:</span> <span class="n">href</span><span class="p">})</span>
                <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="n">href</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Failed to sign URL </span><span class="si">{</span><span class="n">href</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">href</span>
        <span class="k">return</span> <span class="n">href</span>

    <span class="c1"># Function to download a single asset</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_asset</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">asset_key</span><span class="p">,</span> <span class="n">asset</span><span class="p">):</span>
        <span class="n">item_id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>

        <span class="c1"># Get the asset URL and sign it if needed</span>
        <span class="n">asset_url</span> <span class="o">=</span> <span class="n">get_signed_url</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>

        <span class="c1"># Determine output filename</span>
        <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">media_type</span><span class="p">:</span>
            <span class="c1"># Use appropriate file extension based on media type</span>
            <span class="k">if</span> <span class="s2">&quot;tiff&quot;</span> <span class="ow">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">media_type</span> <span class="ow">or</span> <span class="s2">&quot;geotiff&quot;</span> <span class="ow">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">media_type</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.tif&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;jpeg&quot;</span> <span class="ow">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">media_type</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.jpg&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;png&quot;</span> <span class="ow">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">media_type</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.png&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;json&quot;</span> <span class="ow">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">media_type</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.json&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Default extension based on the original URL</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">asset_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;.data&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default extension based on the original URL</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">asset_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;.data&quot;</span>

        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">asset_key</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Skip if file exists and skip_existing is True</span>
        <span class="k">if</span> <span class="n">skip_existing</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping existing asset: </span><span class="si">{</span><span class="n">asset_key</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">asset_key</span><span class="p">,</span> <span class="n">output_path</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Download the asset with progress bar</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">asset_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span>
                        <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">,</span>
                        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
                        <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">unit_divisor</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
                        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Downloading </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">asset_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">asset_key</span><span class="p">,</span> <span class="n">output_path</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error downloading </span><span class="si">{</span><span class="n">asset_key</span><span class="si">}</span><span class="s2"> for item </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>  <span class="c1"># Clean up partial download</span>
            <span class="k">return</span> <span class="n">asset_key</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Process all items and their assets</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">item_assets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">item_id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing STAC item: </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Determine which assets to download</span>
        <span class="k">if</span> <span class="n">asset_keys</span><span class="p">:</span>
            <span class="n">assets_to_download</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">asset_keys</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">assets_to_download</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: None of the specified asset keys </span><span class="si">{</span><span class="n">asset_keys</span><span class="si">}</span><span class="s2"> found in item </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available asset keys: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">assets_to_download</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">assets</span>

        <span class="c1"># Download assets concurrently</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Submit all download tasks</span>
            <span class="n">future_to_asset</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">download_asset</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">asset_key</span><span class="p">,</span> <span class="n">asset</span><span class="p">):</span> <span class="p">(</span>
                    <span class="n">asset_key</span><span class="p">,</span>
                    <span class="n">asset</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">asset_key</span><span class="p">,</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets_to_download</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="c1"># Process results as they complete</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_asset</span><span class="p">):</span>
                <span class="n">asset_key</span><span class="p">,</span> <span class="n">asset</span> <span class="o">=</span> <span class="n">future_to_asset</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
                        <span class="n">item_assets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Error processing asset </span><span class="si">{</span><span class="n">asset_key</span><span class="si">}</span><span class="s2"> for item </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="n">results</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_assets</span>

    <span class="c1"># Count total downloaded assets</span>
    <span class="n">total_assets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="k">for</span> <span class="n">assets</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Downloaded </span><span class="si">{</span><span class="n">total_assets</span><span class="si">}</span><span class="s2"> assets for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.pc_stac_search" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pc_stac_search</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;https://planetarycomputer.microsoft.com/api/stac/v1&#39;</span><span class="p">)</span></code>


<a href="#geoai.download.pc_stac_search" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Search for STAC items in the Planetary Computer catalog.</p>
<p>This function queries the Planetary Computer STAC API to find items matching
the specified criteria, including collection, bounding box, time range, and
additional query parameters.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>collection</code></td>
        <td><code>str</code></td>
        <td><p>The STAC collection ID to search within.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bbox</code></td>
        <td><code>list</code></td>
        <td><p>Bounding box coordinates [west, south, east, north].
Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>time_range</code></td>
        <td><code>str or tuple</code></td>
        <td><p>Time range as a string "start/end" or
a tuple of (start, end) datetime objects. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>query</code></td>
        <td><code>dict</code></td>
        <td><p>Additional query parameters for filtering.
Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>limit</code></td>
        <td><code>int</code></td>
        <td><p>Number of items to return per page. Defaults to 10.</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>max_items</code></td>
        <td><code>int</code></td>
        <td><p>Maximum total number of items to return.
Defaults to None (returns all matching items).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>endpoint</code></td>
        <td><code>str</code></td>
        <td><p>STAC API endpoint URL.
Defaults to "https://planetarycomputer.microsoft.com/api/stac/v1".</p></td>
        <td><code>&#39;https://planetarycomputer.microsoft.com/api/stac/v1&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>List of STAC Item objects matching the search criteria.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If invalid parameters are provided.</p></td>
      </tr>
      <tr>
        <td><code>ConnectionError</code></td>
        <td><p>If there's an issue connecting to the API.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pc_stac_search</span><span class="p">(</span>
    <span class="n">collection</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;https://planetarycomputer.microsoft.com/api/stac/v1&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for STAC items in the Planetary Computer catalog.</span>

<span class="sd">    This function queries the Planetary Computer STAC API to find items matching</span>
<span class="sd">    the specified criteria, including collection, bounding box, time range, and</span>
<span class="sd">    additional query parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The STAC collection ID to search within.</span>
<span class="sd">        bbox (list, optional): Bounding box coordinates [west, south, east, north].</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        time_range (str or tuple, optional): Time range as a string &quot;start/end&quot; or</span>
<span class="sd">            a tuple of (start, end) datetime objects. Defaults to None.</span>
<span class="sd">        query (dict, optional): Additional query parameters for filtering.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        limit (int, optional): Number of items to return per page. Defaults to 10.</span>
<span class="sd">        max_items (int, optional): Maximum total number of items to return.</span>
<span class="sd">            Defaults to None (returns all matching items).</span>
<span class="sd">        endpoint (str, optional): STAC API endpoint URL.</span>
<span class="sd">            Defaults to &quot;https://planetarycomputer.microsoft.com/api/stac/v1&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of STAC Item objects matching the search criteria.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If invalid parameters are provided.</span>
<span class="sd">        ConnectionError: If there&#39;s an issue connecting to the API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

    <span class="c1"># Initialize the STAC client</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to STAC API at </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Process time_range if provided</span>
    <span class="k">if</span> <span class="n">time_range</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_range</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_range</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Convert datetime objects to ISO format strings</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">time_range</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="n">time_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_range</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">time_str</span> <span class="o">=</span> <span class="n">time_range</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;time_range must be a &#39;start/end&#39; string or tuple of (start, end)&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Create the search object</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">collections</span><span class="o">=</span><span class="p">[</span><span class="n">collection</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="n">time_str</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
    <span class="p">)</span>

    <span class="c1"># Collect the items</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use max_items if specified, otherwise get all items</span>
        <span class="k">if</span> <span class="n">max_items</span><span class="p">:</span>
            <span class="n">items_gen</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items_gen</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">max_items</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">get_items</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error retrieving search results: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> items matching search criteria&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">items</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="geoai.download.preview_raster" class="doc doc-heading">
<code class="highlight language-python"><span class="n">preview_raster</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#geoai.download.preview_raster" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Display a preview of the downloaded imagery.</p>
<p>This function creates a visualization of the downloaded NAIP imagery
by converting it to an RGB array and displaying it with matplotlib.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>Any</code></td>
        <td><p>The raster data as a rioxarray object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>title</code></td>
        <td><code>str</code></td>
        <td><p>The title for the preview plot.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>geoai/download.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preview_raster</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display a preview of the downloaded imagery.</span>

<span class="sd">    This function creates a visualization of the downloaded NAIP imagery</span>
<span class="sd">    by converting it to an RGB array and displaying it with matplotlib.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The raster data as a rioxarray object.</span>
<span class="sd">        title: The title for the preview plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert to 8-bit RGB for display</span>
    <span class="n">rgb_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;band&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">rgb_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rgb_data</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">rgb_data</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 28, 2025 04:38:24"><span class="timeago" datetime="2025-02-28T04:38:24+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 28, 2025 04:38:24">2025-02-28</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 28, 2025 04:38:24"><span class="timeago" datetime="2025-02-28T04:38:24+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 28, 2025 04:38:24">2025-02-28</span>
  </span>

    
    
    
  </aside>





                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2025 Qiusheng Wu
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../js/timeago.min.js"></script>
      
        <script src="../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>